sudo: required  #is required to use docker service in travis

services:
  - docker

env:
  - OWNER: cnych
  - IMAGE_NAME: productaste
  - QNAME: ${OWNER}/${IMAGE_NAME}
  - IMAGE_VERSION: v1.${TRAVIS_BUILD_NUMBER}
  - BUILD_TAG: ${QNAME}:${IMAGE_VERSION}
  - LATEST_TAG: ${QNAME}:latest
  - echo ${BUILD_TAG}

before_install:
  - echo "1. before_install"

before_script:
  - echo "2.before_script"

script:
  - pwd
  - echo "3. build docker image"
  - echo ${BUILD_TAG}
  - docker --version
  - docker login -u ${DOCKER_USER} -p ${DOCKER_PASS}
  - docker build -t ${BUILD_TAG} .
  - docker tag ${BUILD_TAG} ${LATEST_TAG}

after_success:
  - echo "4. push docker image"
  - docker push ${BUILD_TAG}
  - docker push ${LATEST_TAG}
